<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>체육 수업 도우미 (온라인 버전)</title>
  <meta name="description" content="체육 수업 진도 관리, PAPS 평가, 리그전 및 토너먼트 수업을 위한 통합 관리 도구. 학생 기록 관리, 등급 자동 계산, 엑셀 내보내기/가져오기 기능 제공." />
  <meta name="keywords" content="체육 수업, PAPS, 체육 평가, 수업 진도 관리, 리그전, 토너먼트, 체육 도우미" />
  <meta name="robots" content="index, follow" />
  <meta name="google-site-verification" content="BAb1Evt0W_EOPGPYxID08YyKTnsQ2D8uJvYpzfhxEfw" />
  <meta name="naver-site-verification" content="8e3626d5e947128b60282a78fdfe9a1a2e6a1d8b" />
  
  <!-- Service Worker 완전 제거 (최우선 실행) -->
  <script>
    (function() {
      // 개발 환경 감지
      var isDev = window.location.hostname === 'localhost' || 
                  window.location.hostname === '127.0.0.1' ||
                  window.location.hostname.startsWith('192.168.') ||
                  window.location.hostname.startsWith('10.') ||
                  window.location.hostname.startsWith('172.');
      
      if (isDev && 'serviceWorker' in navigator) {
        // 즉시 서비스 워커 컨트롤러 업데이트 중지
        if (navigator.serviceWorker.controller) {
          navigator.serviceWorker.controller.postMessage({type: 'SKIP_WAITING'});
        }
        
        // 모든 서비스 워커 등록 해제
        navigator.serviceWorker.getRegistrations().then(function(registrations) {
          var unregisterPromises = [];
          for(var i = 0; i < registrations.length; i++) {
            unregisterPromises.push(registrations[i].unregister());
          }
          return Promise.all(unregisterPromises);
        }).then(function() {
          console.log('Service Worker 완전 제거 완료');
          // 페이지 새로고침하여 서비스 워커 완전 제거
          if (navigator.serviceWorker.controller) {
            window.location.reload();
          }
        }).catch(function(error) {
          console.warn('Service Worker 제거 중 오류:', error);
        });
        
        // 서비스 워커 등록 방지
        navigator.serviceWorker.register = function() {
          console.warn('Service Worker 등록이 차단되었습니다 (개발 환경)');
          return Promise.reject(new Error('Service Worker registration blocked in development'));
        };
      }
    })();
  </script>
  
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#1971c2"/>
  
  <!-- 보안 헤더 -->
  <!-- X-Frame-Options는 HTTP 헤더로만 설정 가능하며, firebase.json에서 처리됩니다 -->
  <meta http-equiv="X-Content-Type-Options" content="nosniff" />
  <meta http-equiv="X-XSS-Protection" content="1; mode=block" />
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin" />
  <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=()" />
  
  <!-- Content Security Policy -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline' 'unsafe-eval' 
      https://cdn.jsdelivr.net 
      https://cdnjs.cloudflare.com 
      https://www.gstatic.com 
      https://*.firebase.com 
      https://*.firebaseapp.com 
      https://*.googleapis.com
      https://apis.google.com
      https://esm.sh;
    style-src 'self' 'unsafe-inline' 
      https://fonts.googleapis.com;
    font-src 'self' data: 
      https://fonts.gstatic.com;
    img-src 'self' data: https:;
    connect-src 'self' 
      https://*.firebase.com 
      https://*.firebaseapp.com 
      https://*.googleapis.com 
      https://*.google.com 
      https://www.gstatic.com
      https://sentry.io
      https://cdn.jsdelivr.net
      https://cdnjs.cloudflare.com
      https://api.qrserver.com;
    frame-src 'self' 
      https://*.firebase.com 
      https://*.firebaseapp.com
      https://accounts.google.com
      https://apis.google.com;
    object-src 'none';
    base-uri 'self';
    form-action 'self';
  " />
  
  <!-- 캐시 무효화: 항상 최신 버전을 사용하도록 설정 -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  
  <!-- 환경 변수 설정 (로깅 시스템을 위한) -->
  <!-- 프로덕션 환경에서는 이 스크립트를 수정하여 window.NODE_ENV와 window.LOG_LEVEL을 설정하세요 -->
  <script>
    // 개발 환경 감지 (기본값)
    // 프로덕션 배포 시 아래 스크립트를 주석 해제하고 값을 설정하세요
    // window.NODE_ENV = 'production'; // 또는 'development', 'staging'
    // window.LOG_LEVEL = 'ERROR'; // 'DEBUG', 'INFO', 'WARN', 'ERROR', 'NONE' (선택적)
    
    // 로컬호스트나 개발 서버에서 자동으로 개발 환경으로 설정
    if (location.hostname === 'localhost' || location.hostname === '127.0.0.1' || 
        location.hostname.startsWith('192.168.') || location.hostname.startsWith('10.') || 
        location.hostname.startsWith('172.')) {
      if (typeof window.NODE_ENV === 'undefined') {
        window.NODE_ENV = 'development';
      }
    }
    
    // Sentry DSN 설정 (선택적)
    // 프로덕션 환경에서 에러 리포팅을 활성화하려면 주석을 해제하고 DSN을 설정하세요
    // window.SENTRY_DSN = 'https://YOUR_DSN@sentry.io/PROJECT_ID';
    // window.ENABLE_SENTRY_DEV = 'false'; // 개발 환경에서 Sentry 활성화 여부
  </script>
  
  <!-- COOP 에러 필터링 - 모든 스크립트 로드 전에 즉시 실행 -->
  <!-- 인라인 스크립트로 즉시 콘솔 오버라이드 -->
  <script>
    // 즉시 실행하여 최대한 빨리 에러 필터링 시작
    (function() {
      // 필터링할 에러 패턴 정의
      var filterPatterns = [
        'cross-origin-opener-policy',
        'coop',
        'popup.ts',
        'window.closed',
        'window.close',
        'would block',
        'policy would block',
        'content_script.js',
        'cannot read properties',
        'reading \'control\'',
        'shouldoffercompletionlistforfield',
        'elementwasfocused',
        'processinputevent',
        'focusineventhandler',
        'inputeventhandler',
        'completion_list.html',
        'pejdijmoenmkgeppbflobdenhhabjlaj',
        'err_file_not_found',
        'net::err_file_not_found',
        'err_quic_protocol_error',
        'err_quic_protocol_error.quic_public_reset',
        'quic_protocol_error',
        'quic_public_reset',
        'err_aborted',
        'net::err_aborted',
        'webchannel_blob',
        'listen/channel',
        'write/channel',
        'err_name_not_resolved',
        'err_internet_disconnected',
        'err_network_changed',
        'err_connection_refused',
        'failed to load resource',
        'net::err_',
        'webchannel_connection.ts',
        'bad request',
        'write/channel',
        'gsessionid',
        '400',
        'service-worker',
        'serviceworker',
        'service worker',
        'fetchevent',
        'fetch event',
        'failed to fetch',
        'network error response',
        'the promise was rejected',
        'fetchevent for',
        'resulted in a network error',
        'err_failed',
        'net::err_failed',
        'localhost:8080',
        'firebasestorage.googleapis.com',
        'cors policy',
        'blocked by cors',
        'preflight request',
        'access control check',
        'storage/retry-limit-exceeded',
        'firebasestorage',
        '저장된 QR 코드가 없습니다'
      ];
      
      // 에러가 필터링해야 할 에러인지 확인
      function shouldFilterError(text) {
        if (!text) return false;
        var str = String(text).toLowerCase();
        
        // 스택 트레이스를 줄 단위로 분리하여 각 줄을 검사
        var lines = str.split('\n');
        var hasPopupTs = false;
        var hasCOOPError = false;
        
        for (var i = 0; i < lines.length; i++) {
          var line = lines[i].trim();
          
          // popup.ts가 포함된 줄 확인
          if (line.includes('popup.ts')) {
            hasPopupTs = true;
          }
          
          // Cross-Origin-Opener-Policy 또는 policy would block이 포함된 줄 확인
          if (line.includes('cross-origin-opener-policy') || 
              line.includes('coop') ||
              (line.includes('policy') && line.includes('would') && line.includes('block'))) {
            hasCOOPError = true;
          }
          
          // popup.ts와 COOP 에러가 함께 있으면 필터링
          if (hasPopupTs && hasCOOPError) {
            return true;
          }
        }
        
        // 패턴 확인
        for (var i = 0; i < filterPatterns.length; i++) {
          if (str.includes(filterPatterns[i])) {
            return true;
          }
        }
        
        // 네트워크 에러 패턴 확인
        if (str.includes('firestore.googleapis.com') && 
            (str.includes('net::') || str.includes('err_') || str.includes('failed to load') || 
             str.includes('400') || str.includes('bad request') || str.includes('write/channel') || str.includes('gsessionid'))) {
          return true;
        }
        
        // 서비스 워커 및 FetchEvent 에러 패턴
        if (str.includes('fetchevent') || str.includes('fetch event') || 
            str.includes('service-worker') || str.includes('serviceworker') ||
            str.includes('resulted in a network error') || str.includes('err_failed') ||
            (str.includes('localhost:8080') && (str.includes('failed') || str.includes('err_')))) {
          return true;
        }
        
        // Firestore Write channel 에러 (더 구체적으로)
        if ((str.includes('write/channel') || str.includes('gsessionid')) && str.includes('400')) {
          return true;
        }
        
        // webchannel_blob과 400 에러 조합
        if (str.includes('webchannel_blob') && (str.includes('400') || str.includes('bad request'))) {
          return true;
        }
        
        // Firestore Write channel과 webchannel_blob 조합
        if (str.includes('webchannel_blob') && (str.includes('write/channel') || str.includes('firestore.googleapis.com'))) {
          return true;
        }
        
        // content_script.js 관련 에러 필터링 (더 강화)
        if (str.includes('content_script.js') || 
            str.includes('shouldoffercompletionlistforfield') ||
            str.includes('elementwasfocused') ||
            str.includes('processinputevent') ||
            str.includes('focusineventhandler') ||
            str.includes('inputeventhandler') ||
            (str.includes('cannot read properties') && str.includes('control'))) {
          return true;
        }
        
        // 조합 패턴 확인
        return (
          (str.includes('policy') && str.includes('would') && str.includes('block')) ||
          (str.includes('window.close') || str.includes('window.closed')) ||
          (str.includes('popup.ts')) ||
          (str.includes('would') && str.includes('block') && (str.includes('window') || str.includes('popup') || str.includes('call'))) ||
          // popup.ts와 COOP 에러가 함께 있는 경우 (스택 트레이스 전체에서)
          (hasPopupTs && (str.includes('cross-origin-opener-policy') || str.includes('coop') || (str.includes('policy') && str.includes('would') && str.includes('block')))) ||
          // 네트워크 관련
          (str.includes('net::') && str.includes('firestore')) ||
          (str.includes('err_') && (str.includes('quic') || str.includes('name') || str.includes('internet') || str.includes('network')))
        );
      }
      
      // console.error 즉시 오버라이드
      var originalError = console.error;
      console.error = function() {
        // 모든 인자를 문자열로 변환하여 검사 (스택 트레이스 포함)
        var fullMessage = Array.prototype.slice.call(arguments).map(function(arg) {
          if (typeof arg === 'string') return arg;
          if (arg instanceof Error) {
            // Error 객체의 모든 정보 포함
            return (arg.message || '') + '\n' + (arg.stack || '') + '\n' + (arg.name || '') + '\n' + arg.toString();
          }
          if (typeof arg === 'object' && arg !== null) {
            try {
              var stringified = JSON.stringify(arg);
              // Error 객체인 경우 stack 속성도 확인
              if (arg.stack) {
                return stringified + '\n' + arg.stack;
              }
              return stringified;
            } catch (e) {
              return String(arg);
            }
          }
          return String(arg);
        }).join('\n'); // 줄바꿈으로 구분하여 스택 트레이스 보존
        
        // 필터링 대상 에러면 차단
        if (shouldFilterError(fullMessage)) {
          return; // 에러 무시
        }
        
        // 원본 console.error 호출
        originalError.apply(console, arguments);
      };
      
      // 에러 이벤트 리스너 (가장 먼저 실행)
      window.addEventListener('error', function(event) {
        var message = event.message || '';
        var stack = (event.error && event.error.stack) || '';
        var filename = event.filename || '';
        var fullText = (message + ' ' + stack + ' ' + filename).toLowerCase();
        
        if (shouldFilterError(fullText) || 
            filename.includes('popup.ts') || 
            filename.includes('webchannel_connection.ts') ||
            filename.includes('webchannel_blob') ||
            filename.includes('content_script.js') ||
            fullText.includes('content_script.js') ||
            fullText.includes('shouldoffercompletionlistforfield') ||
            fullText.includes('elementwasfocused') ||
            fullText.includes('processinputevent') ||
            fullText.includes('inputeventhandler') ||
            fullText.includes('focusineventhandler') ||
            (fullText.includes('cannot read properties') && fullText.includes('control')) ||
            fullText.includes('webchannel_blob') ||
            fullText.includes('quic_protocol_error') ||
            fullText.includes('quic_public_reset') ||
            fullText.includes('err_aborted') ||
            fullText.includes('listen/channel') ||
            fullText.includes('write/channel') ||
            fullText.includes('gsessionid')) {
          event.preventDefault();
          event.stopPropagation();
          event.stopImmediatePropagation();
          return false;
        }
      }, true); // capture phase
      
      // Promise rejection 이벤트
      window.addEventListener('unhandledrejection', function(event) {
        var reason = event.reason || '';
        var message = (reason && reason.message) || String(reason);
        var stack = (reason && reason.stack) || '';
        var fullText = (message + ' ' + stack).toLowerCase();
        
        if (shouldFilterError(fullText) ||
            fullText.includes('content_script.js') ||
            fullText.includes('shouldoffercompletionlistforfield') ||
            fullText.includes('elementwasfocused') ||
            fullText.includes('processinputevent') ||
            fullText.includes('inputeventhandler') ||
            fullText.includes('focusineventhandler') ||
            (fullText.includes('cannot read properties') && fullText.includes('control')) ||
            fullText.includes('webchannel_blob') ||
            fullText.includes('quic_protocol_error') ||
            fullText.includes('quic_public_reset') ||
            fullText.includes('err_aborted') ||
            fullText.includes('listen/channel') ||
            fullText.includes('write/channel') ||
            fullText.includes('gsessionid')) {
          event.preventDefault();
          event.stopPropagation();
          event.stopImmediatePropagation();
          return false;
        }
      }, true);
    })();
  </script>
  <!-- ErrorFilter 모듈 동적 로드 (추가 보강용) -->
  <script type="module">
    // file:// 프로토콜 체크는 인라인 스크립트에서 처리하므로 여기서는 항상 시도
    if (window.location.protocol !== 'file:') {
      (async function() {
        try {
          const { initializeCOOPFilter } = await import('./js/modules/errorFilter.js');
          initializeCOOPFilter();
        } catch (error) {
          // 에러 필터링은 선택적 기능이므로 실패해도 계속 진행
        }
      })();
    }
  </script>
  <!-- Import maps for module resolution -->
  <script type="importmap">
    {
      "imports": {
        "zod": "https://cdn.jsdelivr.net/npm/zod@3.23.8/+esm",
        "@sentry/browser": "https://cdn.jsdelivr.net/npm/@sentry/browser@10.22.0/+esm",
        "dompurify": "https://cdn.jsdelivr.net/npm/dompurify@3.2.2/+esm"
      }
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.2.2/dist/purify.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css?v=2025-11-27-0831">
</head>
<body>
  <a href="#content-wrapper" id="skip-to-main" class="skip-link">본문으로 건너뛰기</a>
  <div id="loader" class="loader hidden" role="status" aria-live="polite" aria-label="데이터 로딩 중">
    <div>데이터를 불러오는 중...</div>
  </div>

  <div id="auth-container" class="auth-container hidden" role="dialog" aria-labelledby="auth-title" aria-modal="true">
      <div class="auth-box">
          <div style="text-align: center; margin-bottom: 24px;">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>
              <h2 id="auth-title" style="margin-top: 8px;">체육 수업 도우미</h2>
          </div>
          <div class="auth-tabs" role="tablist" aria-label="인증 방식 선택">
              <button id="login-tab-btn" class="active" onclick="showAuthForm('login')" role="tab" aria-selected="true" aria-controls="login-form">로그인</button>
              <button id="signup-tab-btn" onclick="showAuthForm('signup')" role="tab" aria-selected="false" aria-controls="signup-form">회원가입</button>
          </div>
          <form id="login-form" class="auth-form" role="tabpanel" aria-labelledby="login-tab" onsubmit="if(window.__handleLoginFormSubmit){window.__handleLoginFormSubmit(event);}return false;">
              <div class="field">
                  <label for="login-email" class="sr-only">이메일</label>
                  <input type="email" id="login-email" placeholder="이메일" autocomplete="email" required aria-required="true" aria-describedby="login-error">
              </div>
              <div class="field">
                  <label for="login-password" class="sr-only">비밀번호</label>
                  <input type="password" id="login-password" placeholder="비밀번호" autocomplete="current-password" required aria-required="true" aria-describedby="login-error">
              </div>
              <a href="#" id="forgot-password-link" class="forgot-password-link">비밀번호를 잊으셨나요?</a>
              <p id="login-error" class="error-message hidden" role="alert" aria-live="polite"></p>
              <button type="submit" class="btn primary" onclick="if(window.__handleLoginButtonDirectClick){window.__handleLoginButtonDirectClick(event);}return false;">로그인</button>
          </form>
          <form id="signup-form" class="auth-form hidden" role="tabpanel" aria-labelledby="signup-tab-btn">
              <div class="field">
                  <label for="signup-name" class="sr-only">닉 네임</label>
                  <input type="text" id="signup-name" placeholder="닉 네임" autocomplete="name" required aria-required="true" aria-describedby="signup-error">
              </div>
              <div class="field">
                  <label for="signup-email" class="sr-only">이메일</label>
                  <input type="email" id="signup-email" placeholder="이메일" autocomplete="email" required aria-required="true" aria-describedby="signup-error">
              </div>
              <div class="field">
                  <label for="signup-password" class="sr-only">비밀번호</label>
                  <input type="password" id="signup-password" placeholder="비밀번호 (6자 이상)" autocomplete="new-password" required aria-required="true" aria-describedby="signup-error">
              </div>
              <p id="signup-error" class="error-message hidden" role="alert" aria-live="polite"></p>
              <button type="submit" class="btn primary">회원가입</button>
          </form>
          
          <form id="reset-form" class="auth-form hidden" role="dialog" aria-labelledby="reset-form-title">
              <h3 id="reset-form-title" class="sr-only">비밀번호 재설정</h3>
              <div class="field">
                  <label for="reset-email" class="sr-only">가입한 이메일 주소</label>
                  <input type="email" id="reset-email" placeholder="가입한 이메일 주소" autocomplete="email" required aria-required="true" aria-describedby="reset-message">
              </div>
              <p id="reset-message" class="hidden" role="alert" aria-live="polite"></p>
              <button type="submit" class="btn primary">재설정 링크 발송</button>
               <a href="#" id="back-to-login-link" class="forgot-password-link" style="text-align: center; margin-top: 16px;">로그인으로 돌아가기</a>
          </form>
          
          <div class="divider" role="separator" aria-label="또는">또는</div>
          <div class="social-buttons" style="justify-content: center;" role="group" aria-label="소셜 로그인">
              <button type="button" id="google-login-btn" class="social-btn" aria-label="Google 계정으로 로그인">
                  <svg viewBox="0 0 48 48" aria-hidden="true"><path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"></path><path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"></path><path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.222,0-9.519-3.487-11.187-8.261l-6.522,5.025C9.505,39.556,16.227,44,24,44z"></path><path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571l6.19,5.238C42.011,35.618,44,30.138,44,24C44,22.659,43.862,21.35,43.611,20.083z"></path></svg>
              </button>
          </div>
      </div>
  </div>

  <div id="app-root" style="display:flex; flex-direction:column; height:100vh;">
      <header class="top-bar" role="banner">
        <div style="display: flex; align-items: center; gap: 12px;">
          <h1>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>
              <span>체육 수업 도우미</span>
              <span class="version" aria-label="온라인 버전">online</span>
          </h1>
        </div>
        <nav class="row" role="navigation" aria-label="주요 메뉴">
            <div id="top-bar-actions" class="row" role="group" aria-label="수업 모드 선택">
                <button class="btn mode-switch-btn active" data-mode="progress" aria-label="수업 진도 관리 화면으로 전환" aria-pressed="true">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                수업 진도 관리
                </button>
                <button class="btn mode-switch-btn" data-mode="paps" aria-label="PAPS 수업 화면으로 전환" aria-pressed="false">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><rect x="3" y="4" width="18" height="14" rx="2"/><path d="M7 8h10"/><path d="M7 12h6"/></svg>
                PAPS 수업
                </button>
                <button class="btn mode-switch-btn" data-mode="league" aria-label="리그전 수업 화면으로 전환" aria-pressed="false">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/></svg>
                리그전 수업
                </button>
                <button class="btn mode-switch-btn" data-mode="tournament" aria-label="토너먼트 수업 화면으로 전환" aria-pressed="false">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M18 8V6a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v2"/><path d="M18 16v2a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2v-2"/><path d="M6 12h12"/></svg>
                토너먼트 수업
                </button>
            </div>
             <div id="user-profile" class="row" style="margin-left: 16px;" role="group" aria-label="사용자 프로필">
                <div id="login-status" class="login-status">
                    <span id="user-email" style="font-weight: 500;" aria-live="polite"></span>
                    <button id="logout-btn" class="btn" aria-label="로그아웃">로그아웃</button>
                </div>
                <div id="guest-status" class="guest-status hidden">
                    <span style="color: var(--ink-muted); font-size: 0.9rem;" aria-live="polite">로컬 모드</span>
                    <button id="login-btn" class="btn primary" onclick="if(window.__handleLoginButtonClick){window.__handleLoginButtonClick();}else if(window.showLoginModal){window.showLoginModal();}else{console.error('로그인 함수를 찾을 수 없음');}" aria-label="로그인">로그인</button>
                </div>
            </div>
            <button class="theme-toggle" id="theme-toggle-btn" onclick="toggleTheme()" aria-label="다크/라이트 모드 전환" aria-pressed="false" data-tooltip="다크/라이트 모드 전환">
              <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
              <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
            </button>
            <button id="undo-btn" class="btn" onclick="handleUndo()" aria-label="실행 취소" data-tooltip="실행 취소 (Ctrl+Z 또는 Cmd+Z)">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M3 7v6h6"></path><path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"></path></svg>
            </button>
            <button id="redo-btn" class="btn" onclick="handleRedo()" aria-label="다시 실행하기" data-tooltip="다시 실행하기 (Ctrl+Y 또는 Ctrl+Shift+Z)">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M21 7v6h-6"></path><path d="M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3L21 13"></path></svg>
            </button>
            <button class="btn" onclick="openHelpPopup()" aria-label="사용설명서 열기">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                사용설명서
            </button>
        </nav>
      </header>
      <div class="app-container">
        <aside class="sidebar" id="sidebar" role="complementary" aria-label="사이드바">
            <!-- 사이드바 토글 버튼은 JavaScript로 동적 생성됩니다 -->
            <h2 class="sidebar-header">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path></svg>
                <span id="sidebarTitle"></span>
            </h2>
            <div id="sidebar-form-container"></div>
            <div id="sidebar-list-container"></div>
            <footer class="sidebar-footer" role="contentinfo">
                <div style="margin-bottom: 8px;">
                    <div class="visitor-info" style="justify-content: center; font-size: 0.8rem;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 14px; height: 14px;" aria-hidden="true">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                        <span>총 방문자 수 : <span id="visitor-count" style="font-weight: 600; color: var(--accent);" aria-live="polite">-</span></span>
                    </div>
                </div>
                <div>Copyright (c) 2025 김신회(laguyo87@gmail.com)</div>
            </footer>
        </aside>
        <main class="main-content" role="main">
          <div class="main-view">
              <div id="content-wrapper" tabindex="-1"></div>
          </div>
        </main>
      </div>
      
      <div id="modal-container" class="hidden" role="dialog" aria-labelledby="modal-title" aria-modal="true" style="position: fixed; inset: 0; z-index: 101; display: flex; align-items: center; justify-content: center; background-color: rgba(0,0,0,0.5);">
        <div class="modal-box" style="background:var(--card-bg); padding: 24px; border-radius: 8px; width: 100%; max-width: 450px;">
            <h3 id="modal-title" style="font-size: 1.25rem; font-weight: 700; margin-top:0; margin-bottom: 1rem;"></h3>
            <div id="modal-body" style="color: var(--ink-muted); margin-bottom: 1.5rem;" role="region" aria-live="polite"></div>
            <div id="modal-actions" style="display: flex; justify-content: flex-end; gap: 0.75rem;" role="group"></div>
        </div>
      </div>
  </div>
    
  <div id="helpPopup" class="hidden" role="dialog" aria-labelledby="help-popup-title" aria-modal="true" style="position: fixed; inset: 0; z-index: 100; display: flex; align-items: center; justify-content: center; background-color: rgba(0,0,0,0.5);">
    <div class="modal-box" style="background:var(--card-bg); padding: 24px; border-radius: 8px; width: 100%; max-width: 800px; max-height: 90vh; display: flex; flex-direction: column;">
        <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-shrink: 0;">
            <h3 id="help-popup-title" style="font-size: 1.25rem; font-weight: 700; margin:0;">프로그램 사용 설명서</h3>
            <button class="btn" onclick="closeHelpPopup()" aria-label="사용설명서 닫기">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        </div>
        <div class="help-popup-content" style="overflow-y: auto;">
            <h2 style="margin-top: 0;">📚 프로그램 사용 설명서</h2>
            
            <div style="background: var(--bg-secondary, #f5f5f5); padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; border-left: 4px solid var(--primary, #007bff);">
                <h3 style="margin-top: 0; color: var(--primary, #007bff);">📌 기본 사용법</h3>
                <p style="margin-bottom: 0;">화면 상단의 <code>수업 진도 관리</code> / <code>리그전 수업</code> / <code>토너먼트 수업</code> / <code>PAPS 수업</code> 버튼으로 네 가지 수업 모드를 전환할 수 있습니다. 각 모드의 데이터는 독립적으로 저장됩니다.</p>
            </div>

            <div style="margin-bottom: 2rem;">
                <h3 style="border-bottom: 2px solid var(--line, #e0e0e0); padding-bottom: 0.5rem; margin-bottom: 1rem;">📝 1️⃣ 수업 진도 관리</h3>
                
                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: var(--text-primary); margin-bottom: 0.5rem;">🏫 반 생성 및 관리</h4>
                    <ul style="margin-top: 0.5rem;">
                <li>왼쪽 사이드바에서 '새로운 반 이름'을 입력하고 <code>+</code> 버튼을 눌러 반을 생성합니다.</li>
                        <li>✏️ 반 카드의 연필 아이콘을 클릭하면 반 이름을 수정할 수 있습니다.</li>
                        <li>🗑️ 휴지통 아이콘을 클릭하면 반과 관련된 모든 데이터가 삭제됩니다.</li>
            </ul>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: var(--text-primary); margin-bottom: 0.5rem;">⚙️ 수업 설정</h4>
                    <ul style="margin-top: 0.5rem;">
                <li>반을 선택한 후, 담당교사, 단원 내용, 주당 시간을 입력하고 <code>설정 저장</code>을 누릅니다.</li>
                        <li>✅ 설정 저장 후 수업 기록 테이블이 자동으로 생성됩니다.</li>
            </ul>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: var(--text-primary); margin-bottom: 0.5rem;">📅 수업 기록 입력</h4>
                    <ul style="margin-top: 0.5rem;">
                <li>각 주차별로 수업 날짜, 교시(1~7교시), 수업 내용을 입력할 수 있습니다.</li>
                        <li>📆 날짜를 입력하면 요일이 자동으로 표시됩니다.</li>
                        <li>💾 수업 내용은 실시간으로 저장됩니다.</li>
            </ul>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: var(--text-primary); margin-bottom: 0.5rem;">📊 엑셀 내보내기/가져오기</h4>
                    <ul style="margin-top: 0.5rem;">
                        <li>📤 왼쪽 사이드바 하단의 <code>모든 반 수업 기록 엑셀로 내보내기</code> 버튼으로 모든 반의 수업 기록을 엑셀 파일로 저장할 수 있습니다.</li>
                        <li>📑 엑셀 파일은 반별로 시트가 구분되어 저장됩니다.</li>
                        <li>📥 <code>모든 반 수업 기록 엑셀에서 가져오기</code> 버튼으로 엑셀 파일의 데이터를 불러올 수 있습니다.</li>
            </ul>
                </div>
            </div>

            <div style="margin-bottom: 2rem;">
                <h3 style="border-bottom: 2px solid var(--line, #e0e0e0); padding-bottom: 0.5rem; margin-bottom: 1rem;">🏆 2️⃣ 리그전 수업</h3>
                
                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: var(--text-primary); margin-bottom: 0.5rem;">👥 반 생성 및 학생 관리</h4>
                    <ul style="margin-top: 0.5rem;">
                <li>왼쪽 사이드바에서 '새로운 반(팀) 이름'을 입력하고 <code>+</code> 버튼을 눌러 리그를 생성합니다.</li>
                        <li>➕ 반을 선택한 후, '신규 선수 추가'에 학생 이름을 입력하고 <code>추가</code> 버튼을 누릅니다.</li>
                        <li>📋 <code>일괄 추가</code> 버튼으로 여러 명의 이름을 쉼표(,)로 구분해 한 번에 등록할 수 있습니다.</li>
                        <li>🔤 <code>가나다 순 정렬</code> 버튼으로 학생 목록을 이름 순으로 정렬할 수 있습니다.</li>
            </ul>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: var(--text-primary); margin-bottom: 0.5rem;">📅 경기 일정 생성</h4>
                    <ul style="margin-top: 0.5rem;">
                <li>학생 추가가 완료되면 <code>일정 생성</code> 버튼을 누르세요.</li>
                        <li>🎯 모든 학생이 한 번씩 맞붙는 리그전 대진표(라운드 로빈)가 자동으로 생성됩니다.</li>
            </ul>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: var(--text-primary); margin-bottom: 0.5rem;">⚽ 경기 결과 입력</h4>
                    <ul style="margin-top: 0.5rem;">
                <li>경기 일정 표에서 각 경기의 점수를 입력하면 자동으로 승점이 계산되고 '완료' 상태로 변경됩니다.</li>
                        <li>✨ 경기 강조 표시 기능으로 특정 경기를 하이라이트할 수 있습니다.</li>
                        <li>📈 점수를 입력하면 순위표가 실시간으로 업데이트됩니다.</li>
            </ul>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: var(--text-primary); margin-bottom: 0.5rem;">📊 엑셀 내보내기/가져오기</h4>
                    <ul style="margin-top: 0.5rem;">
                        <li>📤 왼쪽 사이드바 하단의 <code>모든 반 경기 기록 엑셀로 내보내기</code> 버튼으로 모든 반의 경기 기록을 엑셀 파일로 저장할 수 있습니다.</li>
                        <li>📑 엑셀 파일에는 순위표와 경기 일정이 포함되며, 반별로 시트가 구분됩니다.</li>
                        <li>📥 <code>모든 반 경기 기록 엑셀에서 가져오기</code> 버튼으로 엑셀 파일의 데이터를 불러올 수 있습니다.</li>
            </ul>
                </div>
            </div>

            <div style="margin-bottom: 2rem;">
                <h3 style="border-bottom: 2px solid var(--line, #e0e0e0); padding-bottom: 0.5rem; margin-bottom: 1rem;">🎯 3️⃣ 토너먼트 수업</h3>
                
                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: var(--text-primary); margin-bottom: 0.5rem;">🏁 토너먼트 생성</h4>
                    <ul style="margin-top: 0.5rem;">
                <li>왼쪽 사이드바에서 '새로운 토너먼트 이름'을 입력하고 <code>+</code> 버튼을 눌러 토너먼트를 생성합니다.</li>
            </ul>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: var(--text-primary); margin-bottom: 0.5rem;">👥 팀 추가 및 설정</h4>
                    <ul style="margin-top: 0.5rem;">
                <li>토너먼트를 선택한 후, '참가 팀 관리'에서 팀 이름을 추가합니다.</li>
                        <li>⚙️ <code>토너먼트 설정</code> 버튼을 클릭하여 경기 종목, 시드 배정 방식(입력 순 또는 무작위) 등을 설정하고 <code>설정 저장</code>을 누릅니다.</li>
            </ul>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: var(--text-primary); margin-bottom: 0.5rem;">📋 대진표 관리</h4>
                    <ul style="margin-top: 0.5rem;">
                        <li>🔄 팀을 추가/삭제하면 대진표가 자동으로 생성 및 업데이트됩니다.</li>
                        <li>⚽ 경기 후 대진표의 점수 칸에 결과를 입력하면 승자가 자동으로 다음 라운드로 진출합니다.</li>
                        <li>🏅 최종 순위는 대진표에 메달 아이콘으로 표시됩니다.</li>
            </ul>
                </div>
            </div>

            <div style="margin-bottom: 2rem;">
                <h3 style="border-bottom: 2px solid var(--line, #e0e0e0); padding-bottom: 0.5rem; margin-bottom: 1rem;">💪 4️⃣ PAPS 수업</h3>
                
                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: var(--text-primary); margin-bottom: 0.5rem;">🏫 반 생성 및 설정</h4>
                    <ul style="margin-top: 0.5rem;">
                <li>왼쪽 사이드바에서 '새로운 PAPS 반 이름'을 입력하고 <code>+</code> 버튼을 눌러 PAPS 반을 생성합니다.</li>
                        <li>🎓 반을 선택한 후, 학년을 설정합니다. (초등학교 4-6학년, 중학교 1-3학년, 고등학교 1-3학년)</li>
            </ul>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: var(--text-primary); margin-bottom: 0.5rem;">🏃 종목 설정</h4>
                    <ul style="margin-top: 0.5rem;">
                        <li>❤️ <strong>심폐지구력:</strong> 왕복오래달리기, 오래달리기, 스텝검사</li>
                        <li>🤸 <strong>유연성:</strong> 앉아윗몸앞으로굽히기, 종합유연성검사</li>
                        <li>💪 <strong>근력/근지구력:</strong> 악력(왼손/오른손), 팔굽혀펴기, 윗몸말아올리기</li>
                        <li>⚡ <strong>순발력:</strong> 제자리멀리뛰기, 50m 달리기</li>
                        <li>📏 <strong>체지방:</strong> BMI (신장, 체중 입력 후 자동 계산)</li>
            </ul>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: var(--text-primary); margin-bottom: 0.5rem;">📱 QR 코드를 통한 개인 기록 조회</h4>
                    <ul style="margin-top: 0.5rem;">
                        <li>📱 <code>개인 기록 조회 QR 생성(공유)</code> 버튼을 클릭하면 각 학생의 개인 기록 조회용 QR 코드를 생성할 수 있습니다.</li>
                        <li>📋 QR 코드를 스캔하면 해당 학생의 PAPS 기록, 등급, 학년 내 랭킹을 확인할 수 있습니다.</li>
                        <li>🔗 QR 코드는 실시간으로 업데이트되어 최신 기록을 반영합니다.</li>
                        <li>💾 생성된 QR 코드는 로컬 스토리지에 저장되어 나중에 다시 불러올 수 있습니다.</li>
                        <li>📂 <code>저장된 QR 불러오기</code> 버튼으로 이전에 생성한 QR 코드를 불러올 수 있습니다.</li>
            </ul>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: var(--text-primary); margin-bottom: 0.5rem;">👑 우리 학교 PAPS 종목별 랭킹</h4>
                    <ul style="margin-top: 0.5rem;">
                        <li>🏆 PAPS 대시보드 하단의 <code>우리 학교 PAPS 종목별 랭킹</code> 섹션에서 전체 학생의 랭킹을 조회할 수 있습니다.</li>
                        <li>📊 종목, 학년, 성별을 선택하여 해당 조건에 맞는 학생들의 랭킹을 확인할 수 있습니다.</li>
                        <li>🔍 학생 이름을 입력하면 개인 순위와 상위%를 확인할 수 있습니다.</li>
                        <li>📈 랭킹은 현재 로그인한 사용자의 모든 클래스 데이터를 기반으로 계산됩니다.</li>
                        <li>💪 악력은 왼손과 오른손을 별도로 랭킹을 조회할 수 있습니다.</li>
                        <li>📤 랭킹 결과를 인쇄하거나 공유할 수 있습니다.</li>
            </ul>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: var(--text-primary); margin-bottom: 0.5rem;">👨‍🎓 학생 추가 및 기록 입력</h4>
                    <ul style="margin-top: 0.5rem;">
                        <li>➕ <code>학생 추가</code> 버튼으로 개별 추가하거나, 엑셀 파일로 일괄 업로드할 수 있습니다.</li>
                        <li>📝 학생의 번호, 이름, 성별을 입력합니다.</li>
                        <li>📊 기록입력 테이블에서 각 학생의 측정 기록을 입력합니다.</li>
                        <li>🤲 악력은 왼손과 오른손 각각의 기록을 입력할 수 있습니다.</li>
                        <li>📐 신장(cm)과 체중(kg)을 입력하면 BMI가 자동 계산됩니다.</li>
                        <li>⭐ 기록을 입력하면 성별과 학년에 따른 PAPS 등급이 자동으로 계산되어 표시됩니다.</li>
            </ul>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: var(--text-primary); margin-bottom: 0.5rem;">📊 엑셀 내보내기/가져오기</h4>
                    <ul style="margin-top: 0.5rem;">
                        <li>📤 왼쪽 사이드바 하단의 <code>모든 반 PAPS 기록 엑셀로 내보내기</code> 버튼으로 모든 반의 PAPS 기록을 엑셀 파일로 저장할 수 있습니다.</li>
                        <li>📑 엑셀 파일은 반별로 시트가 구분되어 저장됩니다.</li>
                        <li>📥 <code>모든 반 PAPS 기록 엑셀에서 가져오기</code> 버튼으로 엑셀 파일의 데이터를 불러올 수 있습니다.</li>
            </ul>
                </div>
            </div>

            <div style="background: var(--bg-secondary, #f5f5f5); padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                <h3 style="border-bottom: 2px solid var(--line, #e0e0e0); padding-bottom: 0.5rem; margin-bottom: 1rem; margin-top: 0;">🛠️ 공통 기능</h3>
                
                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: var(--text-primary); margin-bottom: 0.5rem;">☁️ 데이터 저장</h4>
                    <ul style="margin-top: 0.5rem;">
                        <li>💾 모든 데이터는 로그인된 계정에 연결되어 클라우드에 실시간으로 자동 저장됩니다.</li>
                        <li>📱 다른 기기에서 로그인해도 동일한 데이터를 사용할 수 있습니다.</li>
                        <li>🔄 인터넷 연결이 없어도 로컬 스토리지에 임시 저장되며, 연결 시 자동으로 동기화됩니다.</li>
            </ul>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: var(--text-primary); margin-bottom: 0.5rem;">↩️ 실행 취소 / 다시 실행하기</h4>
                    <ul style="margin-top: 0.5rem;">
                        <li>↩️ 상단 바의 실행 취소 아이콘을 클릭하거나 <code>Ctrl+Z</code> (Windows/Linux) / <code>Cmd+Z</code> (Mac)를 누르면 마지막 작업을 취소할 수 있습니다.</li>
                        <li>↪️ 상단 바의 다시 실행하기 아이콘을 클릭하거나 <code>Ctrl+Y</code> (Windows/Linux) / <code>Cmd+Shift+Z</code> (Mac)를 누르면 취소한 작업을 다시 실행할 수 있습니다.</li>
                        <li>📚 최대 50개의 이전 상태까지 되돌릴 수 있습니다.</li>
            </ul>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: var(--text-primary); margin-bottom: 0.5rem;">📂 사이드바 토글</h4>
                    <ul style="margin-top: 0.5rem;">
                        <li>◀️ ▶️ 왼쪽 사이드바의 화살표 버튼을 클릭하면 사이드바를 열고 닫을 수 있습니다.</li>
                        <li>💻 화면 공간을 효율적으로 사용하기 위해 필요시 사이드바를 숨길 수 있습니다.</li>
            </ul>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: var(--text-primary); margin-bottom: 0.5rem;">🌙 야간 모드 (다크 모드)</h4>
                    <ul style="margin-top: 0.5rem;">
                        <li>☀️ 🌙 상단 바의 해/달 아이콘을 클릭하면 라이트 모드와 다크 모드를 전환할 수 있습니다.</li>
                        <li>💾 선택한 테마는 자동으로 저장되어 다음 방문 시에도 유지됩니다.</li>
            </ul>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: var(--text-primary); margin-bottom: 0.5rem;">📊 엑셀 호환성</h4>
                    <ul style="margin-top: 0.5rem;">
                        <li>📤 모든 수업 모드에서 엑셀 파일로 데이터를 내보내고 가져올 수 있습니다.</li>
                        <li>📑 엑셀 파일은 반별로 시트가 구분되어 있어 관리가 용이합니다.</li>
                        <li>🔗 기존 스프레드시트와 연동하여 데이터를 공유할 수 있습니다.</li>
            </ul>
                </div>
            </div>

            <div style="background: var(--bg-secondary, #f5f5f5); color: #000; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                <h3 style="margin-top: 0; color: #000;">⌨️ 키보드 단축키</h3>
                <ul style="margin-bottom: 0; color: #000;">
                    <li>↩️ <code style="color: #000;">Ctrl+Z</code> 또는 <code style="color: #000;">Cmd+Z</code> (Mac): 실행 취소</li>
                    <li>↪️ <code style="color: #000;">Ctrl+Y</code> 또는 <code style="color: #000;">Ctrl+Shift+Z</code> (Windows/Linux) / <code style="color: #000;">Cmd+Shift+Z</code> (Mac): 다시 실행하기</li>
                    <li>🚪 <code style="color: #000;">Escape</code>: 열려있는 모달 창 닫기</li>
            </ul>
            </div>

            <div style="background: var(--bg-secondary, #f5f5f5); padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                <h3 style="margin-top: 0;">💡 주요 특징</h3>
                <ul style="margin-bottom: 0;">
                    <li>⚡ <strong>실시간 계산:</strong> 모든 점수, 순위, 등급이 실시간으로 자동 계산됩니다.</li>
                    <li>📱 <strong>반응형 디자인:</strong> PC, 태블릿, 스마트폰 등 모든 기기에서 최적화된 화면으로 사용할 수 있습니다.</li>
                    <li>🎨 <strong>직관적 UI:</strong> 체육 교사가 쉽게 사용할 수 있도록 직관적인 인터페이스를 제공합니다.</li>
                    <li>📋 <strong>PAPS 2024 기준:</strong> 최신 PAPS 평가 기준을 반영하여 정확한 등급을 제공합니다.</li>
                    <li>🔒 <strong>데이터 안전성:</strong> 클라우드 자동 저장 및 로컬 백업으로 데이터 손실을 방지합니다.</li>
            </ul>
            </div>

            <div style="text-align: center; padding: 1rem; background: var(--bg-secondary, #f5f5f5); border-radius: 8px;">
                <h3 style="margin-top: 0;">📞 문의</h3>
                <p style="margin-bottom: 0.5rem;">프로그램 사용 중 문제가 발생하거나 개선 사항이 있으면 개발자에게 문의해주세요. 🙏</p>
                <p style="margin-bottom: 0; font-weight: 600;">이메일: <a href="mailto:laguyo87@gmail.com" style="color: var(--primary, #007bff); text-decoration: none;">laguyo87@gmail.com</a></p>
            </div>
        </div>
    </div>
  </div>
  


  <script type="module" src="firebase.js"></script>
  
  <script>
    console.log('HTML에서 직접 JavaScript 실행 테스트');
    console.log('DOM 로드 상태:', document.readyState);
    
    // 사용 설명서 팝업 열기
    window.openHelpPopup = function() {
      const helpPopup = document.getElementById('helpPopup');
      if (helpPopup) {
        helpPopup.classList.remove('hidden');
        helpPopup.style.setProperty('display', 'flex', 'important');
        // 첫 번째 포커스 가능한 요소에 포커스
        const firstFocusable = helpPopup.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
        if (firstFocusable) {
          setTimeout(() => firstFocusable.focus(), 100);
        }
        console.log('사용 설명서 팝업 열기');
      } else {
        console.warn('사용 설명서 팝업 요소를 찾을 수 없습니다.');
      }
    };
    
    // 사용 설명서 팝업 닫기
    window.closeHelpPopup = function() {
      const helpPopup = document.getElementById('helpPopup');
      if (helpPopup) {
        helpPopup.classList.add('hidden');
        helpPopup.style.setProperty('display', 'none', 'important');
        console.log('사용 설명서 팝업 닫기');
      }
    };
    
    // 테마 토글 함수 (야간 모드 전환)
    window.toggleTheme = function() {
      const body = document.body;
      const themeToggle = document.getElementById('theme-toggle-btn');
      const currentTheme = body.getAttribute('data-theme');
      
      if (currentTheme === 'dark') {
        // 라이트 모드로 전환
        body.removeAttribute('data-theme');
        localStorage.setItem('theme', 'light');
        if (themeToggle) {
          themeToggle.setAttribute('aria-pressed', 'false');
        }
        console.log('라이트 모드로 전환');
      } else {
        // 다크 모드로 전환
        body.setAttribute('data-theme', 'dark');
        localStorage.setItem('theme', 'dark');
        if (themeToggle) {
          themeToggle.setAttribute('aria-pressed', 'true');
        }
        console.log('다크 모드로 전환');
      }
    };
    
    // 저장된 테마 설정 불러오기
    function initializeTheme() {
      const savedTheme = localStorage.getItem('theme');
      const body = document.body;
      const themeToggle = document.getElementById('theme-toggle-btn');
      
      if (savedTheme === 'dark') {
        body.setAttribute('data-theme', 'dark');
        if (themeToggle) {
          themeToggle.setAttribute('aria-pressed', 'true');
        }
      } else {
        body.removeAttribute('data-theme');
        if (themeToggle) {
          themeToggle.setAttribute('aria-pressed', 'false');
        }
      }
    }
    
    // DOMContentLoaded에서 테마 초기화
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeTheme);
    } else {
      initializeTheme();
    }
    
    // 사이드바 토글 함수 (즉시 사용 가능하도록 전역으로 정의)
    window.toggleSidebar = function() {
      const sidebar = document.getElementById('sidebar');
      const sidebarToggle = document.getElementById('sidebar-toggle');
      
      if (!sidebar) {
        console.warn('사이드바를 찾을 수 없습니다.');
        return;
      }

      const isCollapsed = sidebar.classList.contains('collapsed');
      
      if (isCollapsed) {
        // 사이드바 열기
        sidebar.classList.remove('collapsed');
        sidebar.style.setProperty('width', '340px', 'important');
        sidebar.style.setProperty('min-width', '340px', 'important');
        sidebar.style.setProperty('max-width', '340px', 'important');
        sidebar.style.setProperty('padding', '24px', 'important');
        sidebar.style.setProperty('border-right', '1px solid var(--line)', 'important');
        sidebar.style.setProperty('overflow', 'visible', 'important');
        sidebar.style.setProperty('display', 'flex', 'important');
        sidebar.style.setProperty('visibility', 'visible', 'important');
        sidebar.style.setProperty('opacity', '1', 'important');
        if (sidebarToggle) {
          sidebarToggle.style.setProperty('left', '340px', 'important');
          sidebarToggle.setAttribute('aria-expanded', 'true');
        }
        console.log('사이드바 열기');
      } else {
        // 사이드바 닫기
        sidebar.classList.add('collapsed');
        sidebar.style.setProperty('width', '0', 'important');
        sidebar.style.setProperty('min-width', '0', 'important');
        sidebar.style.setProperty('max-width', '0', 'important');
        sidebar.style.setProperty('padding', '0', 'important');
        sidebar.style.setProperty('border-right', 'none', 'important');
        sidebar.style.setProperty('overflow', 'hidden', 'important');
        if (sidebarToggle) {
          sidebarToggle.style.setProperty('left', '0', 'important');
          sidebarToggle.setAttribute('aria-expanded', 'false');
        }
        console.log('사이드바 닫기');
      }
    };
    
    // 사이드바 토글 버튼 동적 생성
    function createSidebarToggleButton() {
      const sidebar = document.getElementById('sidebar');
      if (!sidebar) {
        console.warn('사이드바를 찾을 수 없어 토글 버튼을 생성할 수 없습니다.');
        return;
      }

      // 기존 버튼 제거 (있다면)
      const existingToggle = document.getElementById('sidebar-toggle');
      if (existingToggle) {
        existingToggle.remove();
      }

      // 새 버튼 생성
      const sidebarToggle = document.createElement('button');
      sidebarToggle.id = 'sidebar-toggle';
      sidebarToggle.className = 'sidebar-toggle';
      sidebarToggle.setAttribute('aria-label', '사이드바 열기/닫기');
      sidebarToggle.setAttribute('aria-expanded', 'true');
      sidebarToggle.setAttribute('aria-controls', 'sidebar');
      sidebarToggle.setAttribute('data-tooltip', '사이드바 열기/닫기');
      
      // SVG 아이콘 추가
      const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
      svg.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
      svg.setAttribute('viewBox', '0 0 24 24');
      svg.setAttribute('fill', 'currentColor');
      svg.setAttribute('stroke', 'none');
      svg.setAttribute('aria-hidden', 'true');
      
      const polygon = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
      polygon.setAttribute('points', '6,4 18,12 6,20');
      svg.appendChild(polygon);
      
      sidebarToggle.appendChild(svg);
      
      // 클릭 이벤트 리스너 직접 연결
      sidebarToggle.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        console.log('사이드바 토글 버튼 클릭됨');
        if (window.toggleSidebar && typeof window.toggleSidebar === 'function') {
          window.toggleSidebar();
        } else {
          console.error('toggleSidebar 함수를 찾을 수 없습니다.');
        }
      });

      // 사이드바에 추가 (body에 추가하는 것이 더 나을 수 있음)
      document.body.appendChild(sidebarToggle);
      
      console.log('사이드바 토글 버튼 생성 완료');
    }
    
    // DOMContentLoaded에서 사이드바 토글 버튼 생성
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function() {
        createSidebarToggleButton();
      });
    } else {
      // DOM이 이미 로드된 경우
      createSidebarToggleButton();
    }
    
    // 약간의 지연 후에도 시도 (동적 로딩 대응)
    setTimeout(function() {
      if (!document.getElementById('sidebar-toggle')) {
        createSidebarToggleButton();
      }
    }, 500);
  </script>
  
  <script type="module" src="main.js?v=2025-11-27-0831"></script>
