<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>체육 수업 도우미 (온라인 버전)</title>
  <meta name="google-site-verification" content="BAb1Evt0W_EOPGPYxID08YyKTnsQ2D8uJvYpzfhxEfw" />
  <meta name="naver-site-verification" content="8e3626d5e947128b60282a78fdfe9a1a2e6a1d8b" />
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#1971c2"/>
  
  <!-- 보안 헤더 -->
  <!-- X-Frame-Options는 HTTP 헤더로만 설정 가능하며, firebase.json에서 처리됩니다 -->
  <meta http-equiv="X-Content-Type-Options" content="nosniff" />
  <meta http-equiv="X-XSS-Protection" content="1; mode=block" />
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin" />
  <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=()" />
  
  <!-- Content Security Policy -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline' 'unsafe-eval' 
      https://cdn.jsdelivr.net 
      https://cdnjs.cloudflare.com 
      https://www.gstatic.com 
      https://*.firebase.com 
      https://*.firebaseapp.com 
      https://*.googleapis.com
      https://apis.google.com
      https://esm.sh;
    style-src 'self' 'unsafe-inline' 
      https://fonts.googleapis.com;
    font-src 'self' 
      https://fonts.gstatic.com;
    img-src 'self' data: https:;
    connect-src 'self' 
      https://*.firebase.com 
      https://*.firebaseapp.com 
      https://*.googleapis.com 
      https://*.google.com 
      https://www.gstatic.com
      https://sentry.io
      https://cdn.jsdelivr.net
      https://cdnjs.cloudflare.com;
    frame-src 'self' 
      https://*.firebase.com 
      https://*.firebaseapp.com
      https://accounts.google.com
      https://apis.google.com;
    object-src 'none';
    base-uri 'self';
    form-action 'self';
  " />
  
  <!-- 캐시 무효화: 항상 최신 버전을 사용하도록 설정 -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  
  <!-- 환경 변수 설정 (로깅 시스템을 위한) -->
  <!-- 프로덕션 환경에서는 이 스크립트를 수정하여 window.NODE_ENV와 window.LOG_LEVEL을 설정하세요 -->
  <script>
    // 개발 환경 감지 (기본값)
    // 프로덕션 배포 시 아래 스크립트를 주석 해제하고 값을 설정하세요
    // window.NODE_ENV = 'production'; // 또는 'development', 'staging'
    // window.LOG_LEVEL = 'ERROR'; // 'DEBUG', 'INFO', 'WARN', 'ERROR', 'NONE' (선택적)
    
    // 로컬호스트나 개발 서버에서 자동으로 개발 환경으로 설정
    if (location.hostname === 'localhost' || location.hostname === '127.0.0.1' || 
        location.hostname.startsWith('192.168.') || location.hostname.startsWith('10.') || 
        location.hostname.startsWith('172.')) {
      if (typeof window.NODE_ENV === 'undefined') {
        window.NODE_ENV = 'development';
      }
    }
    
    // Sentry DSN 설정 (선택적)
    // 프로덕션 환경에서 에러 리포팅을 활성화하려면 주석을 해제하고 DSN을 설정하세요
    // window.SENTRY_DSN = 'https://YOUR_DSN@sentry.io/PROJECT_ID';
    // window.ENABLE_SENTRY_DEV = 'false'; // 개발 환경에서 Sentry 활성화 여부
  </script>
  
  <!-- COOP 에러 필터링 - 모든 스크립트 로드 전에 즉시 실행 -->
  <!-- 인라인 스크립트로 즉시 콘솔 오버라이드 -->
  <script>
    // 즉시 실행하여 최대한 빨리 에러 필터링 시작
    (function() {
      // 필터링할 에러 패턴 정의
      var filterPatterns = [
        'cross-origin-opener-policy',
        'coop',
        'popup.ts',
        'window.closed',
        'window.close',
        'would block',
        'policy would block',
        'err_quic_protocol_error',
        'err_name_not_resolved',
        'err_internet_disconnected',
        'err_network_changed',
        'err_connection_refused',
        'failed to load resource',
        'net::err_',
        'webchannel_connection.ts'
      ];
      
      // 에러가 필터링해야 할 에러인지 확인
      function shouldFilterError(text) {
        if (!text) return false;
        var str = String(text).toLowerCase();
        
        // 패턴 확인
        for (var i = 0; i < filterPatterns.length; i++) {
          if (str.includes(filterPatterns[i])) {
            return true;
          }
        }
        
        // 네트워크 에러 패턴 확인
        if (str.includes('firestore.googleapis.com') && 
            (str.includes('net::') || str.includes('err_') || str.includes('failed to load'))) {
          return true;
        }
        
        // 조합 패턴 확인
        return (
          (str.includes('policy') && str.includes('would') && str.includes('block')) ||
          (str.includes('window.close') || str.includes('window.closed')) ||
          (str.includes('popup.ts')) ||
          (str.includes('would') && str.includes('block') && (str.includes('window') || str.includes('popup') || str.includes('call'))) ||
          // 네트워크 관련
          (str.includes('net::') && str.includes('firestore')) ||
          (str.includes('err_') && (str.includes('quic') || str.includes('name') || str.includes('internet') || str.includes('network')))
        );
      }
      
      // console.error 즉시 오버라이드
      var originalError = console.error;
      console.error = function() {
        var fullMessage = Array.prototype.slice.call(arguments).map(function(arg) {
          if (typeof arg === 'string') return arg;
          if (arg instanceof Error) {
            return (arg.message || '') + ' ' + (arg.stack || '') + ' ' + (arg.name || '');
          }
          if (typeof arg === 'object' && arg !== null) {
            try {
              return JSON.stringify(arg);
            } catch (e) {
              return String(arg);
            }
          }
          return String(arg);
        }).join(' ').toLowerCase();
        
        // 필터링 대상 에러면 차단
        if (shouldFilterError(fullMessage)) {
          return; // 에러 무시
        }
        
        // 원본 console.error 호출
        originalError.apply(console, arguments);
      };
      
      // 에러 이벤트 리스너 (가장 먼저 실행)
      window.addEventListener('error', function(event) {
        var message = event.message || '';
        var stack = (event.error && event.error.stack) || '';
        var filename = event.filename || '';
        var fullText = (message + ' ' + stack + ' ' + filename).toLowerCase();
        
        if (shouldFilterError(fullText) || filename.includes('popup.ts') || filename.includes('webchannel_connection.ts')) {
          event.preventDefault();
          event.stopPropagation();
          event.stopImmediatePropagation();
          return false;
        }
      }, true); // capture phase
      
      // Promise rejection 이벤트
      window.addEventListener('unhandledrejection', function(event) {
        var reason = event.reason || '';
        var message = (reason && reason.message) || String(reason);
        var stack = (reason && reason.stack) || '';
        var fullText = (message + ' ' + stack).toLowerCase();
        
        if (shouldFilterError(fullText)) {
          event.preventDefault();
          event.stopPropagation();
          event.stopImmediatePropagation();
          return false;
        }
      }, true);
    })();
  </script>
  <!-- ErrorFilter 모듈 동적 로드 (추가 보강용) -->
  <script type="module">
    // file:// 프로토콜 체크는 인라인 스크립트에서 처리하므로 여기서는 항상 시도
    if (window.location.protocol !== 'file:') {
      (async function() {
        try {
          const { initializeCOOPFilter } = await import('./js/modules/errorFilter.js');
          initializeCOOPFilter();
        } catch (error) {
          // 에러 필터링은 선택적 기능이므로 실패해도 계속 진행
        }
      })();
    }
  </script>
  <!-- Import maps for module resolution -->
  <script type="importmap">
    {
      "imports": {
        "zod": "https://cdn.jsdelivr.net/npm/zod@3.23.8/+esm",
        "@sentry/browser": "https://cdn.jsdelivr.net/npm/@sentry/browser@10.22.0/+esm",
        "dompurify": "https://cdn.jsdelivr.net/npm/dompurify@3.2.2/+esm"
      }
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.2.2/dist/purify.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <a href="#content-wrapper" id="skip-to-main" class="skip-link">본문으로 건너뛰기</a>
  <div id="loader" class="loader hidden" role="status" aria-live="polite" aria-label="데이터 로딩 중">
    <div>데이터를 불러오는 중...</div>
  </div>

  <div id="auth-container" class="auth-container hidden" role="dialog" aria-labelledby="auth-title" aria-modal="true">
      <div class="auth-box">
          <div style="text-align: center; margin-bottom: 24px;">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>
              <h2 id="auth-title" style="margin-top: 8px;">체육 수업 도우미</h2>
          </div>
          <div class="auth-tabs" role="tablist" aria-label="인증 방식 선택">
              <button id="login-tab-btn" class="active" onclick="showAuthForm('login')" role="tab" aria-selected="true" aria-controls="login-form">로그인</button>
              <button id="signup-tab-btn" onclick="showAuthForm('signup')" role="tab" aria-selected="false" aria-controls="signup-form">회원가입</button>
          </div>
          <form id="login-form" class="auth-form" role="tabpanel" aria-labelledby="login-tab">
              <div class="field">
                  <label for="login-email" class="sr-only">이메일</label>
                  <input type="email" id="login-email" placeholder="이메일" autocomplete="email" required aria-required="true" aria-describedby="login-error">
              </div>
              <div class="field">
                  <label for="login-password" class="sr-only">비밀번호</label>
                  <input type="password" id="login-password" placeholder="비밀번호" autocomplete="current-password" required aria-required="true" aria-describedby="login-error">
              </div>
              <a href="#" id="forgot-password-link" class="forgot-password-link">비밀번호를 잊으셨나요?</a>
              <p id="login-error" class="error-message hidden" role="alert" aria-live="polite"></p>
              <button type="submit" class="btn primary">로그인</button>
          </form>
          <form id="signup-form" class="auth-form hidden" role="tabpanel" aria-labelledby="signup-tab-btn">
              <div class="field">
                  <label for="signup-email" class="sr-only">이메일</label>
                  <input type="email" id="signup-email" placeholder="이메일" autocomplete="email" required aria-required="true" aria-describedby="signup-error">
              </div>
              <div class="field">
                  <label for="signup-password" class="sr-only">비밀번호</label>
                  <input type="password" id="signup-password" placeholder="비밀번호 (6자 이상)" autocomplete="new-password" required aria-required="true" aria-describedby="signup-error">
              </div>
              <p id="signup-error" class="error-message hidden" role="alert" aria-live="polite"></p>
              <button type="submit" class="btn primary">회원가입</button>
          </form>
          
          <form id="reset-form" class="auth-form hidden" role="dialog" aria-labelledby="reset-form-title">
              <h3 id="reset-form-title" class="sr-only">비밀번호 재설정</h3>
              <div class="field">
                  <label for="reset-email" class="sr-only">가입한 이메일 주소</label>
                  <input type="email" id="reset-email" placeholder="가입한 이메일 주소" autocomplete="email" required aria-required="true" aria-describedby="reset-message">
              </div>
              <p id="reset-message" class="hidden" role="alert" aria-live="polite"></p>
              <button type="submit" class="btn primary">재설정 링크 발송</button>
               <a href="#" id="back-to-login-link" class="forgot-password-link" style="text-align: center; margin-top: 16px;">로그인으로 돌아가기</a>
          </form>
          
          <div class="divider" role="separator" aria-label="또는">또는</div>
          <div class="social-buttons" style="justify-content: center;" role="group" aria-label="소셜 로그인">
              <button type="button" id="google-login-btn" class="social-btn" aria-label="Google 계정으로 로그인">
                  <svg viewBox="0 0 48 48" aria-hidden="true"><path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"></path><path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"></path><path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.222,0-9.519-3.487-11.187-8.261l-6.522,5.025C9.505,39.556,16.227,44,24,44z"></path><path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571l6.19,5.238C42.011,35.618,44,30.138,44,24C44,22.659,43.862,21.35,43.611,20.083z"></path></svg>
              </button>
          </div>
      </div>
  </div>

  <div id="app-root" style="display:flex; flex-direction:column; height:100vh;">
      <header class="top-bar" role="banner">
        <div style="display: flex; align-items: center; gap: 12px;">
          <h1>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>
              <span>체육 수업 도우미</span>
              <span class="version" aria-label="버전">v2.2.1</span>
          </h1>
        </div>
        <nav class="row" role="navigation" aria-label="주요 메뉴">
            <div id="top-bar-actions" class="row" role="group" aria-label="수업 모드 선택">
                <button class="btn mode-switch-btn active" data-mode="progress" aria-label="수업 진도 관리 화면으로 전환" aria-pressed="true">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                수업 진도 관리
                </button>
                <button class="btn mode-switch-btn" data-mode="league" aria-label="리그전 수업 화면으로 전환" aria-pressed="false">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/></svg>
                리그전 수업
                </button>
                <button class="btn mode-switch-btn" data-mode="tournament" aria-label="토너먼트 수업 화면으로 전환" aria-pressed="false">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M18 8V6a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v2"/><path d="M18 16v2a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2v-2"/><path d="M6 12h12"/></svg>
                토너먼트 수업
                </button>
                <button class="btn mode-switch-btn" data-mode="paps" aria-label="PAPS 수업 화면으로 전환" aria-pressed="false">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><rect x="3" y="4" width="18" height="14" rx="2"/><path d="M7 8h10"/><path d="M7 12h6"/></svg>
                PAPS 수업
                </button>
            </div>
             <div id="user-profile" class="row" style="margin-left: 16px;" role="group" aria-label="사용자 프로필">
                <div id="login-status" class="login-status">
                    <span id="user-email" style="font-weight: 500;" aria-live="polite"></span>
                    <button id="logout-btn" class="btn" aria-label="로그아웃">로그아웃</button>
                </div>
                <div id="guest-status" class="guest-status hidden">
                    <span style="color: var(--ink-muted); font-size: 0.9rem;" aria-live="polite">로컬 모드</span>
                    <button id="login-btn" class="btn primary" onclick="showLoginModal()" aria-label="로그인">로그인</button>
                </div>
            </div>
            <button class="theme-toggle" id="theme-toggle-btn" aria-label="다크/라이트 모드 전환" aria-pressed="false">
              <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
              <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
            </button>
            <button class="btn" onclick="openHelpPopup()" aria-label="사용설명서 열기">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                사용설명서
            </button>
        </nav>
      </header>
      <div class="app-container">
        <aside class="sidebar" id="sidebar" role="complementary" aria-label="사이드바">
            <button id="sidebar-toggle" class="sidebar-toggle" aria-label="사이드바 열기/닫기" aria-expanded="true" aria-controls="sidebar">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" stroke="none" aria-hidden="true">
                    <polygon points="6,4 18,12 6,20"/>
                </svg>
            </button>
            <h2 class="sidebar-header">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path></svg>
                <span id="sidebarTitle"></span>
            </h2>
            <div id="sidebar-form-container"></div>
            <div id="sidebar-list-container"></div>
            <div class="sidebar-actions" style="border-top: 1px solid var(--line); padding-top: 16px; display: flex; flex-direction: column; gap: 8px;">
                
                <div id="league-excel-actions" class="row" style="justify-content: space-between;">
                    <button id="exportAllLeaguesBtn" class="btn" style="background:var(--win); color:white; flex:1;" aria-label="모든 반의 리그전 결과를 엑셀 파일 하나로 내보내기">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><path d="m11.5 16.5-3-3 3-3"/><path d="m8.5 13.5 7 .01"/></svg>
                        전체 반 엑셀로 내보내기
                    </button>
                    <label for="importAllLeaguesExcel" class="btn" style="flex:1;" aria-label="엑셀 파일에서 여러 반의 리그전 데이터를 가져오기">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><path d="m11.5 10.5 3 3-3 3"/><path d="m8.5 13.5-7 .01"/></svg>
                        전체 반 엑셀에서 가져오기
                    </label>
                    <input type="file" id="importAllLeaguesExcel" accept=".xlsx, .xls" class="hidden" aria-label="엑셀 파일 선택" />
                </div>
                <div id="paps-excel-actions" class="row" style="justify-content: space-between; display:none;">
                    <button id="exportAllPapsBtn" class="btn" style="background:var(--win); color:white; flex:1;" aria-label="모든 반의 PAPS 기록을 엑셀 파일 하나로 내보내기">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><path d="m11.5 16.5-3-3 3-3"/><path d="m8.5 13.5 7 .01"/></svg>
                        전체 반 엑셀로 내보내기
                    </button>
                    <label for="importAllPapsExcel" class="btn" style="flex:1;" aria-label="엑셀 파일에서 여러 반의 PAPS 데이터를 가져오기">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><path d="m11.5 10.5 3 3-3 3"/><path d="m8.5 13.5-7 .01"/></svg>
                        전체 반 엑셀에서 가져오기
                    </label>
                    <input type="file" id="importAllPapsExcel" accept=".xlsx, .xls" class="hidden" aria-label="엑셀 파일 선택" />
                </div>
            </div>
            <footer class="sidebar-footer" role="contentinfo">
                <div style="margin-bottom: 8px;">
                    <div class="visitor-info" style="justify-content: center; font-size: 0.8rem;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 14px; height: 14px;" aria-hidden="true">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                        <span>총 방문자 수 : <span id="visitor-count" style="font-weight: 600; color: var(--accent);" aria-live="polite">-</span></span>
                    </div>
                </div>
                <div>만든이: 김신회(laguyo87@gmail.com)</div>
            </footer>
        </aside>
        <main class="main-content" role="main">
          <div class="main-view">
              <div id="content-wrapper" tabindex="-1"></div>
          </div>
        </main>
      </div>
      
      <button id="liveRankingBtn" class="btn primary floating-btn" onclick="openRankingPopup()" aria-label="실시간 순위표 열기">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M6 10v9"/><path d="M12 4v15"/><path d="M18 7v12"/></svg>
      </button>

      <div id="rankingPopup" class="hidden" role="dialog" aria-labelledby="popupTitle" aria-modal="true" style="position: fixed; inset: 0; z-index: 100; display: flex; align-items: center; justify-content: center; background-color: rgba(0,0,0,0.5);">
        <div class="modal-box" style="background:var(--card-bg); padding: 24px; border-radius: 8px; width: 100%; max-width: 800px; max-height: 90vh; display: flex; flex-direction: column;">
            <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h3 id="popupTitle" style="font-size: 1.25rem; font-weight: 700; margin:0;"></h3>
                <div class="row">
                    <button class="btn" onclick="printLiveRankings()" aria-label="순위표 인쇄">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>
                    </button>
                    <button class="btn" onclick="closeRankingPopup()" aria-label="순위표 닫기">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </div>
            </div>
            <div style="overflow-y: auto;">
               <table id="popupRankingsTable" class="styled-table" role="table" aria-label="순위표"></table>
            </div>
        </div>
      </div>
      
      <div id="modal-container" class="hidden" role="dialog" aria-labelledby="modal-title" aria-modal="true" style="position: fixed; inset: 0; z-index: 101; display: flex; align-items: center; justify-content: center; background-color: rgba(0,0,0,0.5);">
        <div class="modal-box" style="background:var(--card-bg); padding: 24px; border-radius: 8px; width: 100%; max-width: 450px;">
            <h3 id="modal-title" style="font-size: 1.25rem; font-weight: 700; margin-top:0; margin-bottom: 1rem;"></h3>
            <div id="modal-body" style="color: var(--ink-muted); margin-bottom: 1.5rem;" role="region" aria-live="polite"></div>
            <div id="modal-actions" style="display: flex; justify-content: flex-end; gap: 0.75rem;" role="group"></div>
        </div>
      </div>
  </div>
    
  <div id="helpPopup" class="hidden" role="dialog" aria-labelledby="help-popup-title" aria-modal="true" style="position: fixed; inset: 0; z-index: 100; display: flex; align-items: center; justify-content: center; background-color: rgba(0,0,0,0.5);">
    <div class="modal-box" style="background:var(--card-bg); padding: 24px; border-radius: 8px; width: 100%; max-width: 800px; max-height: 90vh; display: flex; flex-direction: column;">
        <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-shrink: 0;">
            <h3 id="help-popup-title" style="font-size: 1.25rem; font-weight: 700; margin:0;">프로그램 사용 설명서</h3>
            <button class="btn" onclick="closeHelpPopup()" aria-label="사용설명서 닫기">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        </div>
        <div class="help-popup-content" style="overflow-y: auto;">
            <h3>1. 핵심 기능: 4가지 수업 모드</h3>
            <p>화면 상단의 <code>수업 진도 관리</code> / <code>리그전 수업</code> / <code>토너먼트 수업</code> / <code>PAPS 수업</code> 버튼으로 네 가지 모드를 전환할 수 있습니다. 데이터는 각 모드별로 따로 저장됩니다.</p>

            <h3>2. 수업 진도 관리 방법</h3>
            <p><strong>① 반 생성:</strong> 왼쪽 사이드바에서 '새로운 반 이름'을 입력하고 <code>+</code> 버튼을 눌러 반을 생성합니다.</p>
            <p><strong>② 수업 설정:</strong> 생성된 반을 선택한 후, 담당교사, 단원 내용, 주당 시간을 입력하고 <code>설정 저장</code>을 누릅니다.</p>
            <p><strong>③ 진도표 생성:</strong> 설정 저장 후 수업 기록 테이블이 자동으로 생성됩니다. 각 주차별로 수업 날짜와 내용을 기록할 수 있습니다.</p>
            <p><strong>④ 수정하기:</strong> 왼쪽 반 카드의 연필 아이콘을 클릭하면 수업 설정을 다시 수정할 수 있습니다.</p>

            <h3>3. 리그전 수업 방법</h3>
            <p><strong>① 반 생성:</strong> 왼쪽 사이드바에서 '새로운 반(팀) 이름'을 입력하고 <code>+</code> 버튼을 눌러 리그를 생성합니다.</p>
            <p><strong>② 학생 추가:</strong></p>
            <ul>
                <li>생성된 반을 선택한 후, '신규 선수 추가'에 학생 이름을 입력하고 '추가'합니다.</li>
                <li>'일괄 추가' 버튼으로 여러 명의 이름을 쉼표(,)로 구분해 한 번에 등록할 수 있습니다.</li>
            </ul>
            <p><strong>③ 경기 일정 생성:</strong> 학생 추가가 완료되면, <code>일정 생성</code> 버튼을 누르세요. 모든 학생이 한 번씩 맞붙는 리그전 대진표(라운드 로빈)가 자동으로 만들어집니다.</p>
            <p><strong>④ 점수 입력:</strong> 경기 일정 표에서 각 경기의 점수를 입력하면 자동으로 승점이 계산되고 '완료' 상태로 변경됩니다.</p>
            <p><strong>⑤ 순위 확인:</strong> 점수를 입력하면 순위표가 실시간으로 업데이트됩니다. 우측의 <code>실시간 순위표</code> 버튼으로 큰 팝업창에서 순위를 보거나 <code>순위표 인쇄</code> 버튼으로 인쇄할 수 있습니다.</p>

            <h3>4. 토너먼트 관리 방법</h3>
            <p><strong>① 토너먼트 생성:</strong> 왼쪽 사이드바에서 '새로운 토너먼트 이름'을 입력하고 <code>+</code> 버튼을 눌러 토너먼트를 생성합니다.</p>
            <p><strong>② 팀 추가 및 설정:</strong></p>
            <ul>
                <li>생성된 토너먼트를 선택 후, '참가 팀 관리'에서 팀 이름을 추가합니다.</li>
                <li>'토너먼트 설정'에서 경기 종목, 시드 배정 방식(입력 순 또는 무작위) 등을 설정하고 <code>설정 저장</code>을 누릅니다.</li>
            </ul>
            <p><strong>③ 대진표 관리:</strong> 팀을 추가/삭제하면 대진표가 자동으로 생성 및 업데이트됩니다. 경기 후 대진표의 점수 칸에 결과를 입력하면 승자가 자동으로 다음 라운드로 진출합니다. 최종 순위는 대진표에 메달 아이콘으로 표시됩니다.</p>

            <h3>5. PAPS 수업 관리 방법</h3>
            <p><strong>① PAPS 반 생성:</strong> 왼쪽 사이드바에서 '새로운 PAPS 반 이름'을 입력하고 <code>+</code> 버튼을 눌러 PAPS 반을 생성합니다.</p>
            <p><strong>② 학년 설정:</strong> 생성된 반을 선택한 후, 학년을 설정합니다. (초등학교 4-6학년, 중학교 1-3학년, 고등학교 1-3학년)</p>
            <p><strong>③ 종목 설정:</strong> 각 카테고리별로 측정 종목을 선택합니다:</p>
            <ul>
                <li><strong>심폐지구력:</strong> 왕복오래달리기, 오래달리기, 스텝검사</li>
                <li><strong>유연성:</strong> 앉아윗몸앞으로굽히기, 종합유연성검사</li>
                <li><strong>근력/근지구력:</strong> 악력, 팔굽혀펴기, 윗몸말아올리기</li>
                <li><strong>순발력:</strong> 제자리멀리뛰기, 50m 달리기</li>
                <li><strong>체지방:</strong> BMI (신장, 체중 입력)</li>
            </ul>
            <p><strong>④ 학생 추가:</strong></p>
            <ul>
                <li>'학생 추가' 버튼으로 개별 추가하거나, 엑셀 파일로 일괄 업로드할 수 있습니다.</li>
                <li>학생의 번호, 이름, 성별을 입력합니다.</li>
            </ul>
            <p><strong>⑤ 기록 입력:</strong> 기록입력 테이블에서 각 학생의 측정 기록을 입력합니다:</p>
            <ul>
                <li><strong>악력:</strong> 왼손과 오른손 각각의 기록을 입력할 수 있습니다.</li>
                <li><strong>팔굽혀펴기:</strong> 남학생은 팔굽혀펴기, 여학생은 무릎대고 팔굽혀펴기로 자동 표시됩니다.</li>
                <li><strong>체지방:</strong> 신장(cm)과 체중(kg)을 입력하면 BMI가 자동 계산됩니다.</li>
            </ul>
            <p><strong>⑥ 등급 확인:</strong> 기록을 입력하면 성별과 학년에 따른 PAPS 등급이 자동으로 계산되어 표시됩니다.</p>
            <p><strong>⑦ 데이터 내보내기:</strong> 엑셀 파일로 전체 데이터를 내보내거나, 그래프로 등급 분포를 확인할 수 있습니다.</p>

            <h3>6. 데이터 관리 및 기타 기능</h3>
            <ul>
                <li><strong>자동 저장:</strong> 모든 데이터는 로그인된 계정에 연결되어 클라우드에 실시간으로 자동 저장됩니다. 다른 기기에서 로그인해도 데이터를 그대로 사용할 수 있습니다.</li>
                <li><strong>테마 변경:</strong> 우측 상단의 해/달 아이콘으로 라이트/다크 모드를 전환할 수 있습니다.</li>
                <li><strong>엑셀 호환성:</strong> PAPS 데이터는 엑셀 파일로 내보내기/가져오기가 가능하여 기존 스프레드시트와 연동할 수 있습니다.</li>
            </ul>

            <h3>7. 주요 특징</h3>
            <ul>
                <li><strong>실시간 계산:</strong> 모든 점수와 등급이 실시간으로 자동 계산됩니다.</li>
                <li><strong>반응형 디자인:</strong> PC, 태블릿, 스마트폰 등 모든 기기에서 사용 가능합니다.</li>
                <li><strong>직관적 UI:</strong> 체육 교사가 쉽게 사용할 수 있도록 설계되었습니다.</li>
                <li><strong>PAPS 2024 기준:</strong> 최신 PAPS 평가 기준을 반영하여 정확한 등급을 제공합니다.</li>
            </ul>
        </div>
    </div>
  </div>
  


  <script type="module" src="firebase.js"></script>
  
  <script>
    console.log('HTML에서 직접 JavaScript 실행 테스트');
    console.log('DOM 로드 상태:', document.readyState);
  </script>
  
  <script type="module" src="main.js"></script>
